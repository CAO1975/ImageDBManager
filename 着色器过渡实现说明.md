# 着色器过渡动画实现说明

## 概述
根据示例程序，成功在本项目中添加了着色器过渡动画效果。

## 主要更改

### 1. CMakeLists.txt
- 添加了 `ShaderTools` 组件支持
- 在 `target_link_libraries` 中添加了 `Qt6::ShaderTools`
- 在 `qt_add_qml_module` 的 `RESOURCES` 中添加了着色器文件 `shaders/transitions.frag.qsb`
- 在 `QML_FILES` 中添加了 `qml/ImageTransition.qml`

### 2. ImageTransition.qml (新文件)
- 创建了独立的着色器过渡组件
- 着色器路径定义：`qrc:/qt/qml/ImageDBManager/shaders/qsb/transitions.frag.qsb`
- 支持的过渡效果：
  - 0: 溶解
  - 1: 马赛克
  - 2: 波纹
  - 3: 水波
  - 4: 从左向右擦除
  - 5: 从右向左擦除
  - 6: 从上向下擦除
  - 7: 从下向上擦除
  - 8: X轴窗帘
  - 9: Y轴窗帘
  - 10: 故障
  - 11: 旋转
  - 12: 拉伸
  - 13: 百叶窗

### 3. ImageViewer.qml
- 添加了三个新属性：
  - `useShaderTransition`: 控制是否使用着色器过渡
  - `shaderEffectType`: 指定着色器效果类型
  - `shaderTransitionPath`: 着色器文件路径（与 ImageTransition 中相同）
- 在 UI 中集成了 `ImageTransition` 组件，并将 `shaderPath` 绑定到 `shaderTransitionPath`
- 修改了 `loadImage()` 函数以支持着色器过渡
- 修改了 `endTransition()` 函数以支持着色器过渡
- 添加了停止着色器过渡动画的逻辑

### 4. Main.qml
- 在过渡效果下拉框中添加了14种着色器过渡选项（索引27-40）
- 修改了 `transitionComboBox` 的 `onCurrentIndexChanged` 处理逻辑
  - 索引0：随机效果（传统动画）
  - 索引1-26：传统QML动画效果
  - 索引27-40：着色器过渡效果
- 更新了加载设置的逻辑以支持着色器过渡

## 着色器路径定义位置

着色器路径在以下两个地方定义（保持一致）：

1. **ImageTransition.qml**（组件内部默认值）
   ```qml
   property string shaderPath: "qrc:/qt/qml/ImageDBManager/shaders/qsb/transitions.frag.qsb"
   ```

2. **ImageViewer.qml**（传递给组件）
   ```qml
   property string shaderTransitionPath: "qrc:/qt/qml/ImageDBManager/shaders/qsb/transitions.frag.qsb"
   ```

3. **使用时的绑定**
   ```qml
   ImageTransition {
       id: shaderTransition
       shaderPath: shaderTransitionPath  // 从 ImageViewer 传递
       ...
   }
   ```

## 着色器文件
- `shaders/transitions.frag`: GLSL着色器源文件
- `shaders/transitions.frag.qsb`: 编译后的着色器二进制文件（使用 compile_shader.bat 编译）

## 使用方法
1. 在工具栏的过渡效果下拉框中选择"着色器:xxx"类型的效果
2. 使用方向键或点击图片列表切换图片时，会应用着色器过渡效果
3. 可以在过渡时间下拉框中调整过渡持续时间

## 技术要点
- 着色器使用 `ShaderEffect` 组件实现
- 通过 `ShaderEffectSource` 获取两张图片的纹理
- 使用 Timer 实现平滑的进度动画
- 支持缓动函数 easeInOutQuad 优化动画流畅度
- 与传统QML动画并存，可以通过切换选择不同类型
- 着色器路径采用模块化设计，既可在组件内部定义，也可从外部传递

## 编译说明
确保着色器已编译：
```
compile_shader.bat
```
该脚本会将 `shaders/transitions.frag` 编译为 `shaders/transitions.frag.qsb`

## 故障排除
如果看到红色区域：
- 检查控制台输出中的 ShaderEffect 状态和日志
- 确认着色器文件路径正确
- 确保 shaders/transitions.frag.qsb 文件存在
- 查看是否有着色器编译错误
